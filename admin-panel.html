<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administraci√≥n - BotRedd</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(20, 20, 40, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 105, 180, 0.2);
            padding: 20px;
            z-index: 100;
            overflow-y: auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            margin-bottom: 30px;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .logo-text {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-section {
            margin-bottom: 25px;
        }
        
        .nav-title {
            font-size: 0.75em;
            text-transform: uppercase;
            color: #888;
            letter-spacing: 1px;
            margin-bottom: 10px;
            padding-left: 15px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: #aaa;
            text-decoration: none;
        }
        
        .nav-item:hover, .nav-item.active {
            background: rgba(255, 105, 180, 0.15);
            color: #ff69b4;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(255, 105, 180, 0.2), rgba(255, 20, 147, 0.2));
            border: 1px solid rgba(255, 105, 180, 0.3);
        }
        
        .nav-icon {
            font-size: 1.2em;
        }
        
        /* Main Content */
        .main-content {
            margin-left: 280px;
            padding: 30px;
            min-height: 100vh;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 1.8em;
            font-weight: 600;
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
        }
        
        .stat-mini {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-mini-value {
            font-size: 1.3em;
            font-weight: 700;
            color: #ff69b4;
        }
        
        .stat-mini-label {
            font-size: 0.75em;
            color: #888;
        }
        
        /* Cards */
        .card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 1.2em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-title-icon {
            width: 35px;
            height: 35px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Form Styles */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-size: 0.85em;
            color: #aaa;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
            font-size: 0.95em;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ff69b4;
            background: rgba(255, 105, 180, 0.1);
        }
        
        .form-group input::placeholder {
            color: #666;
        }
        
        .form-group select option {
            background: #1a1a2e;
            color: #fff;
        }
        
        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9em;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(255, 105, 180, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ff4757, #ff3344);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #00d4aa, #00b894);
            color: white;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 0.8em;
        }
        
        /* Table */
        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(255, 105, 180, 0.1);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85em;
            color: #ff69b4;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.9em;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        /* Status Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .badge-active {
            background: rgba(0, 212, 170, 0.15);
            color: #00d4aa;
            border: 1px solid rgba(0, 212, 170, 0.3);
        }
        
        .badge-inactive {
            background: rgba(255, 71, 87, 0.15);
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }
        
        .badge-expired {
            background: rgba(150, 150, 150, 0.15);
            color: #999;
            border: 1px solid rgba(150, 150, 150, 0.3);
        }
        
        .badge-count {
            background: rgba(255, 105, 180, 0.15);
            color: #ff69b4;
            border: 1px solid rgba(255, 105, 180, 0.3);
        }
        
        /* Link Display */
        .link-display {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 105, 180, 0.1);
            border-radius: 12px;
            border: 1px solid rgba(255, 105, 180, 0.2);
        }
        
        .link-input {
            flex: 1;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            color: #fff;
        }
        
        /* Success/Error Messages */
        .message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-top: 15px;
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .message-success {
            background: rgba(0, 212, 170, 0.15);
            border: 1px solid rgba(0, 212, 170, 0.3);
            color: #00d4aa;
        }
        
        .message-error {
            background: rgba(255, 71, 87, 0.15);
            border: 1px solid rgba(255, 71, 87, 0.3);
            color: #ff4757;
        }
        
        /* Alert/Info Box */
        .alert {
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .alert-info {
            background: rgba(0, 200, 255, 0.1);
            border: 1px solid rgba(0, 200, 255, 0.2);
        }
        
        .alert-icon {
            font-size: 1.5em;
        }
        
        .alert-content h4 {
            color: #00c8ff;
            margin-bottom: 5px;
        }
        
        .alert-content p {
            color: #aaa;
            font-size: 0.9em;
            line-height: 1.6;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: #888;
            font-size: 0.85em;
            margin-top: 5px;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }
        
        .tab {
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #888;
            font-weight: 500;
        }
        
        .tab:hover {
            color: #fff;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            color: white;
        }
        
        /* Action Buttons in Table */
        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        /* Client Info in Table */
        .client-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .client-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        .client-details h4 {
            font-weight: 500;
            margin-bottom: 2px;
        }
        
        .client-details span {
            font-size: 0.8em;
            color: #888;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid rgba(255, 105, 180, 0.2);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #888;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .modal-close:hover {
            color: #ff4757;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(255, 105, 180, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 105, 180, 0.5);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
                padding: 15px 10px;
            }
            
            .logo-text, .nav-text, .nav-title {
                display: none;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .main-content {
                margin-left: 80px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <div class="logo-icon">ü§ñ</div>
            <span class="logo-text">BotRedd</span>
        </div>
        
        <nav>
            <div class="nav-section">
                <div class="nav-title">Principal</div>
                <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                    <span class="nav-icon">üìä</span>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('clients')">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-text">Clientes</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('ads')">
                    <span class="nav-icon">üì¢</span>
                    <span class="nav-text">Anuncios</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Crear</div>
                <a href="#" class="nav-item" onclick="showSection('new-client')">
                    <span class="nav-icon">‚ûï</span>
                    <span class="nav-text">Nuevo Cliente</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('new-ad')">
                    <span class="nav-icon">üìù</span>
                    <span class="nav-text">Nuevo Anuncio</span>
                </a>
            </div>
            
            <div class="nav-section">
                <div class="nav-title">Finanzas</div>
                <a href="#" class="nav-item" onclick="showSection('finances')">
                    <span class="nav-icon">üí∞</span>
                    <span class="nav-text">Ganancias</span>
                </a>
                <a href="#" class="nav-item" onclick="showSection('blocked')">
                    <span class="nav-icon">üö´</span>
                    <span class="nav-text">Cuentas Bloqueadas</span>
                </a>
            </div>
        </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="section-dashboard">
            <div class="header">
                <h1>üìä Dashboard</h1>
                <div class="header-stats">
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="headerTotalClients">0</div>
                        <div class="stat-mini-label">Clientes</div>
                    </div>
                    <div class="stat-mini">
                        <div class="stat-mini-value" id="headerTotalAds">0</div>
                        <div class="stat-mini-label">Anuncios</div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalClients">0</div>
                    <div class="stat-label">Total Clientes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalAds">0</div>
                    <div class="stat-label">Total Anuncios</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeAds">0</div>
                    <div class="stat-label">Anuncios Activos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="expiredAds">0</div>
                    <div class="stat-label">Expirados</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üì¢</div>
                        Anuncios Recientes
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Anuncio</th>
                                <th>Cliente</th>
                                <th>Estado</th>
                                <th>Pr√≥ximo Bump</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="recentAdsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Clients Section -->
        <section id="section-clients" style="display: none;">
            <div class="header">
                <h1>üë• Clientes</h1>
                <button class="btn btn-primary" onclick="showSection('new-client')">
                    ‚ûï Nuevo Cliente
                </button>
            </div>
            
            <div class="card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Cliente</th>
                                <th>Tel√©fono</th>
                                <th>Anuncios</th>
                                <th>Creado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Ads Section -->
        <section id="section-ads" style="display: none;">
            <div class="header">
                <h1>üì¢ Todos los Anuncios</h1>
                <button class="btn btn-primary" onclick="showSection('new-ad')">
                    ‚ûï Nuevo Anuncio
                </button>
            </div>
            
            <div class="card">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Anuncio</th>
                                <th>Cliente</th>
                                <th>Ciudad</th>
                                <th>Estado</th>
                                <th>Tiempo Restante</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="allAdsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- New Client Section -->
        <section id="section-new-client" style="display: none;">
            <div class="header">
                <h1>‚ûï Nuevo Cliente</h1>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">üí°</span>
                <div class="alert-content">
                    <h4>Crear un Cliente</h4>
                    <p>Crea un cliente primero, luego podr√°s asignarle anuncios. El cliente recibir√° un link √∫nico para ver todos sus anuncios.</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üë§</div>
                        Informaci√≥n del Cliente
                    </div>
                </div>
                
                <form id="newClientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombre del Cliente *</label>
                            <input type="text" id="clientName" placeholder="Ej: Mar√≠a Garc√≠a" required>
                        </div>
                        <div class="form-group">
                            <label>Tel√©fono (opcional)</label>
                            <input type="text" id="clientPhone" placeholder="Ej: +1 234 567 8900">
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Notas (opcional)</label>
                            <textarea id="clientNotes" rows="3" placeholder="Informaci√≥n adicional sobre el cliente..."></textarea>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        ‚úÖ Crear Cliente
                    </button>
                </form>
                
                <div id="clientSuccessMessage" class="message message-success">
                    ‚úÖ Cliente creado exitosamente!
                </div>
                
                <div id="clientLinkDisplay" class="link-display" style="display: none;">
                    <input type="text" id="generatedClientLink" class="link-input" readonly>
                    <button onclick="copyClientLink()" class="btn btn-secondary btn-sm">üìã Copiar</button>
                    <button onclick="openClientLink()" class="btn btn-primary btn-sm">üîó Abrir</button>
                </div>
            </div>
        </section>
        
        <!-- New Ad Section -->
        <section id="section-new-ad" style="display: none;">
            <div class="header">
                <h1>üìù Nuevo Anuncio</h1>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">üí°</span>
                <div class="alert-content">
                    <h4>Crear un Anuncio</h4>
                    <p>Asigna el anuncio a un cliente, registra cu√°nto pag√≥ y si usas una cuenta nueva de MegaPersonals.</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üì¢</div>
                        Informaci√≥n del Anuncio
                    </div>
                </div>
                
                <form id="newAdForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Asignar a Cliente *</label>
                            <select id="adClientSelect" required>
                                <option value="">Seleccionar cliente...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Nombre/Identificador (opcional)</label>
                            <input type="text" id="adName" placeholder="Ej: Anuncio 1, Principal, etc.">
                        </div>
                    </div>
                    
                    <div class="form-grid" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div class="form-group">
                            <label>üíµ Pago del Cliente ($) *</label>
                            <input type="number" id="adClientPayment" placeholder="100" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>üìÖ Duraci√≥n (d√≠as)</label>
                            <input type="number" id="adDuration" placeholder="7" min="1" value="7">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 20px; background: rgba(255, 165, 0, 0.1); border: 1px solid rgba(255, 165, 0, 0.3); border-radius: 12px;">
                        <h4 style="color: #ffa500; margin-bottom: 15px;">üí∏ ¬øUsas una cuenta MegaPersonals nueva?</h4>
                        <p style="color: #888; font-size: 0.85em; margin-bottom: 15px;">Solo llena esto si compraste una cuenta nueva para este anuncio. Si reusas una cuenta existente, d√©jalo vac√≠o.</p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Email de la cuenta</label>
                                <input type="text" id="adMpEmail" placeholder="cuenta@ejemplo.com">
                            </div>
                            <div class="form-group">
                                <label>Contrase√±a</label>
                                <input type="text" id="adMpPassword" placeholder="contrase√±a123">
                            </div>
                            <div class="form-group">
                                <label>Costo de la cuenta ($)</label>
                                <input type="number" id="adMpCost" placeholder="280" min="0" step="0.01">
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="margin-top: 20px;">
                        ‚úÖ Crear Anuncio
                    </button>
                </form>
                
                <div id="adSuccessMessage" class="message message-success">
                    ‚úÖ Anuncio creado exitosamente!
                </div>
                
                <div id="adIdDisplay" class="link-display" style="display: none;">
                    <span style="color: #aaa;">ID del Anuncio (usar en la extensi√≥n):</span>
                    <input type="text" id="generatedAdId" class="link-input" readonly>
                    <button onclick="copyAdId()" class="btn btn-secondary btn-sm">üìã Copiar ID</button>
                </div>
            </div>
        </section>
        
        <!-- Finances Section -->
        <section id="section-finances" style="display: none;">
            <div class="header">
                <h1>üí∞ Finanzas</h1>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card" style="border-color: rgba(0, 212, 170, 0.3);">
                    <div class="stat-value" id="totalIncome" style="background: linear-gradient(135deg, #00d4aa, #00b894); -webkit-background-clip: text;">$0</div>
                    <div class="stat-label">üíµ Total Cobrado</div>
                </div>
                <div class="stat-card" style="border-color: rgba(255, 71, 87, 0.3);">
                    <div class="stat-value" id="totalExpense" style="background: linear-gradient(135deg, #ff4757, #ff3344); -webkit-background-clip: text;">$0</div>
                    <div class="stat-label">üí∏ Total Gastado</div>
                </div>
                <div class="stat-card" style="border-color: rgba(255, 105, 180, 0.3);">
                    <div class="stat-value" id="totalBalance">$0</div>
                    <div class="stat-label">üìä Balance</div>
                </div>
                <div class="stat-card" style="border-color: rgba(255, 165, 0, 0.3);">
                    <div class="stat-value" id="totalLoss" style="background: linear-gradient(135deg, #ffa500, #ff8c00); -webkit-background-clip: text;">$0</div>
                    <div class="stat-label">üö´ P√©rdidas (Bloqueos)</div>
                </div>
            </div>
            
            <!-- Agregar Pago de Cliente -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üíµ</div>
                        Registrar Pago de Cliente
                    </div>
                </div>
                <form id="addPaymentForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Descripci√≥n *</label>
                            <input type="text" id="paymentDesc" placeholder="Ej: Pago semana 1 - Juan" required>
                        </div>
                        <div class="form-group">
                            <label>Monto ($) *</label>
                            <input type="number" id="paymentAmount" placeholder="100" min="0" step="0.01" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">üí∞ Registrar Ingreso</button>
                </form>
            </div>
            
            <!-- Agregar Gasto (Cuenta MP) -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üí∏</div>
                        Registrar Compra de Cuenta MegaPersonals
                    </div>
                </div>
                <form id="addExpenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Email de la Cuenta *</label>
                            <input type="text" id="expenseEmail" placeholder="cuenta@ejemplo.com" required>
                        </div>
                        <div class="form-group">
                            <label>Contrase√±a *</label>
                            <input type="text" id="expensePassword" placeholder="contrase√±a123" required>
                        </div>
                        <div class="form-group">
                            <label>Costo ($) *</label>
                            <input type="number" id="expenseCost" placeholder="280" min="0" step="0.01" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-danger">üí∏ Registrar Gasto</button>
                </form>
            </div>
            
            <!-- Historial de Movimientos -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üìã</div>
                        Historial de Movimientos
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Descripci√≥n</th>
                                <th>Monto</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="movementsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <!-- Blocked Accounts Section -->
        <section id="section-blocked" style="display: none;">
            <div class="header">
                <h1>üö´ Cuentas Bloqueadas</h1>
            </div>
            
            <div class="alert alert-info">
                <span class="alert-icon">üí°</span>
                <div class="alert-content">
                    <h4>Cuentas Bloqueadas</h4>
                    <p>Aqu√≠ aparecen las cuentas de MegaPersonals que fueron bloqueadas. Estas se detectan autom√°ticamente por el bot o puedes agregarlas manualmente. El costo de cada cuenta bloqueada se registra como p√©rdida.</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="card-title-icon">üö´</div>
                        Lista de Cuentas Bloqueadas
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>üìß Email</th>
                                <th>üîë Contrase√±a</th>
                                <th>üí∏ Costo (P√©rdida)</th>
                                <th>üìÖ Fecha Bloqueo</th>
                                <th>Origen</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="blockedAccountsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirmar Eliminaci√≥n</h3>
                <button class="modal-close" onclick="closeModal('deleteModal')">&times;</button>
            </div>
            <p style="color: #aaa; margin-bottom: 20px;">¬øEst√°s seguro de que deseas eliminar este elemento? Esta acci√≥n no se puede deshacer.</p>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal('deleteModal')">Cancelar</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
            </div>
        </div>
    </div>
    
    <script>
        const FIREBASE_URL = 'https://ezequielredd-default-rtdb.firebaseio.com';
        const DASHBOARD_BASE_URL = 'https://botredd.github.io/megapersonals-dashboard2/client-multi-ads.html';
        
        // Navigation
        function showSection(sectionName) {
            document.querySelectorAll('section').forEach(s => s.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`section-${sectionName}`).style.display = 'block';
            event.target.closest('.nav-item')?.classList.add('active');
            
            // Refresh data when switching sections
            if (sectionName === 'dashboard') loadDashboard();
            if (sectionName === 'clients') loadClients();
            if (sectionName === 'ads') loadAllAds();
            if (sectionName === 'new-ad') loadClientSelect();
            if (sectionName === 'finances') loadFinances();
            if (sectionName === 'blocked') loadBlockedAccounts();
        }
        
        // Modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        // Load Dashboard
        async function loadDashboard() {
            try {
                const [clientsRes, adsRes] = await Promise.all([
                    fetch(`${FIREBASE_URL}/clientsInfo.json`),
                    fetch(`${FIREBASE_URL}/clients.json`)
                ]);
                
                const clients = await clientsRes.json() || {};
                const ads = await adsRes.json() || {};
                
                const clientCount = Object.keys(clients).length;
                const adsArray = Object.entries(ads).map(([id, ad]) => ({ id, ...ad }));
                const adCount = adsArray.length;
                const activeCount = adsArray.filter(ad => ad.active !== false && !isExpired(ad)).length;
                const expiredCount = adsArray.filter(ad => isExpired(ad)).length;
                
                // Update stats
                document.getElementById('totalClients').textContent = clientCount;
                document.getElementById('headerTotalClients').textContent = clientCount;
                document.getElementById('totalAds').textContent = adCount;
                document.getElementById('headerTotalAds').textContent = adCount;
                document.getElementById('activeAds').textContent = activeCount;
                document.getElementById('expiredAds').textContent = expiredCount;
                
                // Recent ads table
                const recentAds = adsArray.slice(-10).reverse();
                document.getElementById('recentAdsTable').innerHTML = recentAds.map(ad => {
                    const client = Object.values(clients).find(c => c.id === ad.clientId);
                    const status = getAdStatus(ad);
                    const nextBump = getNextBumpTime(ad);
                    
                    return `
                        <tr>
                            <td>
                                <div class="client-info">
                                    <div class="client-avatar">${(ad.name || ad.phone || '?')[0].toUpperCase()}</div>
                                    <div class="client-details">
                                        <h4>${ad.name || ad.phone || 'Sin nombre'}</h4>
                                        <span>${ad.city || 'Sin ciudad'}</span>
                                    </div>
                                </div>
                            </td>
                            <td>${client?.name || 'Sin asignar'}</td>
                            <td><span class="badge ${status.class}">${status.text}</span></td>
                            <td>${nextBump}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-secondary" onclick="copyAdId('${ad.id}')">üìã ID</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }
        
        // Load Clients
        async function loadClients() {
            try {
                const [clientsRes, adsRes] = await Promise.all([
                    fetch(`${FIREBASE_URL}/clientsInfo.json`),
                    fetch(`${FIREBASE_URL}/clients.json`)
                ]);
                
                const clients = await clientsRes.json() || {};
                const ads = await adsRes.json() || {};
                
                const clientsArray = Object.entries(clients).map(([id, client]) => {
                    const clientAds = Object.values(ads).filter(ad => ad.clientId === client.id);
                    return { id, ...client, adCount: clientAds.length };
                });
                
                document.getElementById('clientsTable').innerHTML = clientsArray.map(client => `
                    <tr>
                        <td>
                            <div class="client-info">
                                <div class="client-avatar">${(client.name || '?')[0].toUpperCase()}</div>
                                <div class="client-details">
                                    <h4>${client.name || 'Sin nombre'}</h4>
                                    <span>ID: ${client.id?.slice(-8) || 'N/A'}</span>
                                </div>
                            </div>
                        </td>
                        <td>${client.phone || '-'}</td>
                        <td><span class="badge badge-count">${client.adCount} anuncios</span></td>
                        <td>${formatDate(client.createdAt)}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-sm btn-primary" onclick="copyLink('${client.id}')">üìã Link</button>
                                <button class="btn btn-sm btn-secondary" onclick="openLink('${client.id}')">üîó Abrir</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteClient('${client.id}')">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('Error loading clients:', error);
            }
        }
        
        // Load All Ads
        async function loadAllAds() {
            try {
                const [clientsRes, adsRes] = await Promise.all([
                    fetch(`${FIREBASE_URL}/clientsInfo.json`),
                    fetch(`${FIREBASE_URL}/clients.json`)
                ]);
                
                const clients = await clientsRes.json() || {};
                const ads = await adsRes.json() || {};
                
                const adsArray = Object.entries(ads).map(([id, ad]) => ({ id, ...ad }));
                
                document.getElementById('allAdsTable').innerHTML = adsArray.map(ad => {
                    const client = Object.values(clients).find(c => c.id === ad.clientId);
                    const status = getAdStatus(ad);
                    const remaining = getRemainingTime(ad);
                    
                    return `
                        <tr>
                            <td>
                                <div class="client-info">
                                    <div class="client-avatar">${(ad.phone || '?')[0]}</div>
                                    <div class="client-details">
                                        <h4>${ad.phone || 'Sin tel√©fono'}</h4>
                                        <span>${ad.name || 'Sin nombre'}</span>
                                    </div>
                                </div>
                            </td>
                            <td>${client?.name || 'Sin asignar'}</td>
                            <td>${ad.city || '-'}</td>
                            <td><span class="badge ${status.class}">${status.text}</span></td>
                            <td>${remaining}</td>
                            <td>
                                <div class="action-buttons">
                                    <button class="btn btn-sm btn-secondary" onclick="copyToClipboard('${ad.id}')">üìã ID</button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteAd('${ad.id}')">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');
                
            } catch (error) {
                console.error('Error loading ads:', error);
            }
        }
        
        // Load Client Select for New Ad
        async function loadClientSelect() {
            try {
                const res = await fetch(`${FIREBASE_URL}/clientsInfo.json`);
                const clients = await res.json() || {};
                
                const select = document.getElementById('adClientSelect');
                select.innerHTML = '<option value="">Seleccionar cliente...</option>';
                
                Object.entries(clients).forEach(([id, client]) => {
                    select.innerHTML += `<option value="${client.id}">${client.name} (${client.phone || 'Sin tel'})</option>`;
                });
                
            } catch (error) {
                console.error('Error loading clients for select:', error);
            }
        }
        
        // Create New Client
        document.getElementById('newClientForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('clientName').value.trim();
            const phone = document.getElementById('clientPhone').value.trim();
            const notes = document.getElementById('clientNotes').value.trim();
            
            const clientId = 'person_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            
            try {
                await fetch(`${FIREBASE_URL}/clientsInfo/${clientId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        id: clientId,
                        name,
                        phone,
                        notes,
                        createdAt: Date.now()
                    })
                });
                
                const link = `${DASHBOARD_BASE_URL}?client=${clientId}`;
                document.getElementById('generatedClientLink').value = link;
                document.getElementById('clientLinkDisplay').style.display = 'flex';
                document.getElementById('clientSuccessMessage').style.display = 'flex';
                
                // Reset form
                e.target.reset();
                
                // Hide success after 5 seconds
                setTimeout(() => {
                    document.getElementById('clientSuccessMessage').style.display = 'none';
                }, 5000);
                
            } catch (error) {
                console.error('Error creating client:', error);
                alert('Error al crear cliente');
            }
        });
        
        // Create New Ad
        document.getElementById('newAdForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const clientId = document.getElementById('adClientSelect').value;
            const name = document.getElementById('adName').value.trim();
            
            const adId = 'client_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const now = Date.now();
            const clientPayment = parseFloat(document.getElementById('adClientPayment').value) || 0;
            const duration = parseInt(document.getElementById('adDuration').value) || 7;
            const mpEmail = document.getElementById('adMpEmail').value.trim();
            const mpPassword = document.getElementById('adMpPassword').value.trim();
            const mpCost = parseFloat(document.getElementById('adMpCost').value) || 0;
            
            try {
                // Crear el anuncio
                await fetch(`${FIREBASE_URL}/clients/${adId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        clientId,
                        name: name || 'Anuncio',
                        active: false,
                        createdAt: now,
                        duration: duration * 24 * 60, // Convertir d√≠as a minutos
                        clientPayment: clientPayment,
                        mpEmail: mpEmail || null,
                        mpCost: mpCost || null
                    })
                });
                
                // Registrar el pago del cliente como ingreso
                if (clientPayment > 0) {
                    const clientInfo = await fetch(`${FIREBASE_URL}/clientsInfo/${clientId}.json`).then(r => r.json());
                    const clientName = clientInfo?.name || 'Cliente';
                    
                    await fetch(`${FIREBASE_URL}/movements/mov_${now}.json`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'income',
                            description: `Pago: ${clientName} - ${name || 'Anuncio'}`,
                            amount: clientPayment,
                            date: now,
                            adId: adId,
                            clientId: clientId
                        })
                    });
                }
                
                // Si hay cuenta MP nueva, registrar el gasto
                if (mpEmail && mpCost > 0) {
                    await fetch(`${FIREBASE_URL}/movements/mov_${now + 1}.json`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            type: 'expense',
                            description: `Cuenta MP: ${mpEmail}`,
                            amount: mpCost,
                            date: now,
                            adId: adId,
                            accountEmail: mpEmail
                        })
                    });
                    
                    // Guardar la cuenta MP
                    await fetch(`${FIREBASE_URL}/mpAccounts/acc_${now}.json`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email: mpEmail,
                            password: mpPassword,
                            cost: mpCost,
                            status: 'active',
                            adId: adId,
                            createdAt: now
                        })
                    });
                }
                
                document.getElementById('generatedAdId').value = adId;
                document.getElementById('adIdDisplay').style.display = 'flex';
                document.getElementById('adSuccessMessage').style.display = 'flex';
                
                // Reset form
                e.target.reset();
                document.getElementById('adDuration').value = '7';
                
                setTimeout(() => {
                    document.getElementById('adSuccessMessage').style.display = 'none';
                }, 5000);
                
            } catch (error) {
                console.error('Error creating ad:', error);
                alert('Error al crear anuncio');
            }
        });
        
        // Helper Functions
        function isExpired(ad) {
            if (!ad.startTime || !ad.duration) return false;
            return Date.now() > ad.startTime + (ad.duration * 60 * 1000);
        }
        
        function getAdStatus(ad) {
            if (isExpired(ad)) return { text: 'Expirado', class: 'badge-expired' };
            if (ad.active === false) return { text: 'Pausado', class: 'badge-inactive' };
            return { text: 'Activo', class: 'badge-active' };
        }
        
        function getNextBumpTime(ad) {
            if (!ad.nextBumpTime) return '-';
            const diff = ad.nextBumpTime - Date.now();
            if (diff <= 0) return 'Ahora';
            const mins = Math.floor(diff / 60000);
            const secs = Math.floor((diff % 60000) / 1000);
            return `${mins}m ${secs}s`;
        }
        
        function getRemainingTime(ad) {
            if (!ad.startTime || !ad.duration) return '-';
            const end = ad.startTime + (ad.duration * 60 * 1000);
            const diff = end - Date.now();
            if (diff <= 0) return 'Expirado';
            
            const days = Math.floor(diff / (24 * 60 * 60 * 1000));
            const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
            const mins = Math.floor((diff % (60 * 60 * 1000)) / (60 * 1000));
            
            if (days > 0) return `${days}d ${hours}h`;
            if (hours > 0) return `${hours}h ${mins}m`;
            return `${mins}m`;
        }
        
        function formatDate(timestamp) {
            if (!timestamp) return '-';
            return new Date(timestamp).toLocaleDateString('es-ES', {
                day: '2-digit',
                month: 'short',
                year: 'numeric'
            });
        }
        
        function copyLink(clientId) {
            const link = `${DASHBOARD_BASE_URL}?client=${clientId}`;
            copyToClipboard(link);
        }
        
        function openLink(clientId) {
            const link = `${DASHBOARD_BASE_URL}?client=${clientId}`;
            window.open(link, '_blank');
        }
        
        function copyClientLink() {
            const link = document.getElementById('generatedClientLink').value;
            copyToClipboard(link);
        }
        
        function openClientLink() {
            const link = document.getElementById('generatedClientLink').value;
            window.open(link, '_blank');
        }
        
        function copyAdId(adId) {
            if (typeof adId === 'string') {
                copyToClipboard(adId);
            } else {
                const id = document.getElementById('generatedAdId').value;
                copyToClipboard(id);
            }
        }
        
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                // Show temporary notification
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #00d4aa, #00b894);
                    color: white;
                    padding: 15px 25px;
                    border-radius: 10px;
                    font-weight: 500;
                    z-index: 9999;
                    animation: fadeIn 0.3s;
                `;
                notification.textContent = '‚úÖ Copiado al portapapeles';
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 2000);
            });
        }
        
        async function deleteClient(clientId) {
            if (!confirm('¬øEliminar este cliente y todos sus datos?')) return;
            
            try {
                await fetch(`${FIREBASE_URL}/clientsInfo/${clientId}.json`, { method: 'DELETE' });
                loadClients();
            } catch (error) {
                console.error('Error deleting client:', error);
            }
        }
        
        async function deleteAd(adId) {
            if (!confirm('¬øEliminar este anuncio?')) return;
            
            try {
                await fetch(`${FIREBASE_URL}/clients/${adId}.json`, { method: 'DELETE' });
                loadAllAds();
            } catch (error) {
                console.error('Error deleting ad:', error);
            }
        }
        
        // ==================== FINANZAS ====================
        async function loadFinances() {
            try {
                const [movementsRes, blockedRes] = await Promise.all([
                    fetch(`${FIREBASE_URL}/movements.json`),
                    fetch(`${FIREBASE_URL}/blockedAccounts.json`)
                ]);
                
                const movements = await movementsRes.json() || {};
                const blocked = await blockedRes.json() || {};
                
                let totalIncome = 0;
                let totalExpense = 0;
                let totalLoss = 0;
                
                // Calcular totales
                Object.values(movements).forEach(mov => {
                    if (mov.type === 'income') {
                        totalIncome += mov.amount || 0;
                    } else if (mov.type === 'expense') {
                        totalExpense += mov.amount || 0;
                    } else if (mov.type === 'loss') {
                        totalLoss += mov.amount || 0;
                    }
                });
                
                // Tambi√©n sumar p√©rdidas de cuentas bloqueadas
                Object.values(blocked).forEach(acc => {
                    if (acc.cost) {
                        totalLoss += acc.cost;
                    }
                });
                
                const balance = totalIncome - totalExpense - totalLoss;
                
                // Actualizar UI
                document.getElementById('totalIncome').textContent = '$' + totalIncome.toFixed(2);
                document.getElementById('totalExpense').textContent = '$' + totalExpense.toFixed(2);
                document.getElementById('totalLoss').textContent = '$' + totalLoss.toFixed(2);
                document.getElementById('totalBalance').textContent = (balance >= 0 ? '+' : '') + '$' + balance.toFixed(2);
                
                // Color del balance
                const balanceEl = document.getElementById('totalBalance');
                if (balance > 0) {
                    balanceEl.style.background = 'linear-gradient(135deg, #00d4aa, #00b894)';
                } else if (balance < 0) {
                    balanceEl.style.background = 'linear-gradient(135deg, #ff4757, #ff3344)';
                } else {
                    balanceEl.style.background = 'linear-gradient(135deg, #ff69b4, #ff1493)';
                }
                balanceEl.style.webkitBackgroundClip = 'text';
                
                // Tabla de movimientos
                const movArray = Object.entries(movements).map(([id, mov]) => ({ id, ...mov }));
                movArray.sort((a, b) => (b.date || 0) - (a.date || 0));
                
                document.getElementById('movementsTable').innerHTML = movArray.length === 0 
                    ? '<tr><td colspan="5" style="text-align: center; color: #666; padding: 30px;">No hay movimientos registrados</td></tr>'
                    : movArray.slice(0, 50).map(mov => {
                        let typeText, typeColor;
                        if (mov.type === 'income') {
                            typeText = 'üí∞ Ingreso';
                            typeColor = '#00d4aa';
                        } else if (mov.type === 'expense') {
                            typeText = 'üí∏ Gasto';
                            typeColor = '#ffa500';
                        } else {
                            typeText = 'üö´ P√©rdida';
                            typeColor = '#ff4757';
                        }
                        
                        const dateStr = mov.date ? new Date(mov.date).toLocaleDateString('es-ES') : '-';
                        const amountStr = mov.type === 'income' ? '+$' + mov.amount.toFixed(2) : '-$' + mov.amount.toFixed(2);
                        
                        return `
                            <tr>
                                <td>${dateStr}</td>
                                <td style="color: ${typeColor}">${typeText}</td>
                                <td>${mov.description || '-'}</td>
                                <td style="color: ${typeColor}; font-weight: 600;">${amountStr}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="deleteMovement('${mov.id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
            } catch (error) {
                console.error('Error loading finances:', error);
            }
        }
        
        // Agregar pago (ingreso)
        document.getElementById('addPaymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const desc = document.getElementById('paymentDesc').value.trim();
            const amount = parseFloat(document.getElementById('paymentAmount').value) || 0;
            
            const movId = 'mov_' + Date.now();
            
            try {
                await fetch(`${FIREBASE_URL}/movements/${movId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'income',
                        description: desc,
                        amount: amount,
                        date: Date.now()
                    })
                });
                
                e.target.reset();
                loadFinances();
                showNotification('‚úÖ Ingreso registrado');
            } catch (error) {
                console.error('Error:', error);
            }
        });
        
        // Agregar gasto (cuenta MP)
        document.getElementById('addExpenseForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('expenseEmail').value.trim();
            const password = document.getElementById('expensePassword').value.trim();
            const cost = parseFloat(document.getElementById('expenseCost').value) || 0;
            
            const movId = 'mov_' + Date.now();
            const accId = 'acc_' + Date.now();
            
            try {
                // Registrar como gasto
                await fetch(`${FIREBASE_URL}/movements/${movId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: 'expense',
                        description: `Cuenta MP: ${email}`,
                        amount: cost,
                        date: Date.now(),
                        accountEmail: email
                    })
                });
                
                // Guardar cuenta activa
                await fetch(`${FIREBASE_URL}/mpAccounts/${accId}.json`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        password: password,
                        cost: cost,
                        status: 'active',
                        createdAt: Date.now()
                    })
                });
                
                e.target.reset();
                loadFinances();
                showNotification('‚úÖ Cuenta registrada');
            } catch (error) {
                console.error('Error:', error);
            }
        });
        
        async function deleteMovement(movId) {
            if (!confirm('¬øEliminar este movimiento?')) return;
            
            try {
                await fetch(`${FIREBASE_URL}/movements/${movId}.json`, { method: 'DELETE' });
                loadFinances();
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        // ==================== CUENTAS BLOQUEADAS ====================
        async function loadBlockedAccounts() {
            try {
                const response = await fetch(`${FIREBASE_URL}/blockedAccounts.json`);
                const blocked = await response.json() || {};
                
                const blockedArray = Object.entries(blocked).map(([id, acc]) => ({ id, ...acc }));
                blockedArray.sort((a, b) => (b.blockedAt || 0) - (a.blockedAt || 0));
                
                document.getElementById('blockedAccountsTable').innerHTML = blockedArray.length === 0
                    ? '<tr><td colspan="6" style="text-align: center; color: #666; padding: 30px;">No hay cuentas bloqueadas</td></tr>'
                    : blockedArray.map(acc => {
                        const dateStr = acc.blockedAt ? new Date(acc.blockedAt).toLocaleDateString('es-ES') : '-';
                        const origin = acc.reportedFrom === 'extension' ? 'ü§ñ Bot' : 'üë§ Manual';
                        const cost = acc.cost || 0;
                        
                        return `
                            <tr style="background: rgba(255, 71, 87, 0.05);">
                                <td style="font-family: monospace;">${acc.email || '-'}</td>
                                <td style="font-family: monospace;">${acc.password || '-'}</td>
                                <td style="color: #ff4757; font-weight: 600;">-$${cost.toFixed(2)}</td>
                                <td>${dateStr}</td>
                                <td><span class="badge badge-count">${origin}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-danger" onclick="deleteBlockedAccount('${acc.id}')">üóëÔ∏è</button>
                                </td>
                            </tr>
                        `;
                    }).join('');
                    
            } catch (error) {
                console.error('Error loading blocked accounts:', error);
            }
        }
        
        async function deleteBlockedAccount(accId) {
            if (!confirm('¬øEliminar este registro de cuenta bloqueada?')) return;
            
            try {
                await fetch(`${FIREBASE_URL}/blockedAccounts/${accId}.json`, { method: 'DELETE' });
                loadBlockedAccounts();
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #00d4aa, #00b894);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-weight: 500;
                z-index: 9999;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // Initialize
        loadDashboard();
        setInterval(loadDashboard, 5000);
    </script>
</body>
</html>
